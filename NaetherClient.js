const tilesImage = new Image();
tilesImage.src = "Images/basictiles.png";

const playerSprites = new Image();
playerSprites.src = "Images/characters.png";

const socket = io.connect("http://localhost:8081");

let town = {};
let townExit = {};
let players = [];

let animatedCount = 0;
let animatedStep = 0;

socket.on("player positions", function(theplayer){
	players = theplayer;
});



var mapArray=[
[180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,129,129,129,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,129,144,144,144,16,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,3,129,144,144,144,16,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,3,3,3,3,3,3,3,3,3,3,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,3,129,129,129,129,129,129,129,129,129,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,3,129,2,2,2,2,2,2,2,2,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,129,2,2,2,2,2,16,16,2,2,2,2,2,2,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,144,129,129,129,129,129,144,144,129,129,129,129,129,3,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,144,144,144,144,144,144,144,144,144,144,144,144,129,3,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,144,144,144,144,144,144,144,144,144,144,144,144,129,3,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,144,144,144,144,144,144,144,144,144,144,144,144,129,3,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,144,129,129,129,129,129,129,129,129,129,129,129,129,3,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,129,2,2,2,2,2,2,2,2,2,2,2,2,2,180,180],
[180,180,180,3,129,2,16,16,16,16,16,16,2,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,3,129,2,2,2,16,16,2,2,2,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,3,129,129,129,129,144,144,129,129,129,129,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[3,3,3,3,129,129,129,129,144,144,129,129,129,144,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[129,129,129,129,129,129,144,144,144,144,144,144,144,144,144,144,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[96,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,16,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[96,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,16,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,129,2,16,16,16,16,16,16,16,16,16,16,16,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,3,129,2,2,2,2,2,2,2,2,2,2,2,2,2,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,3,129,129,129,129,129,129,129,129,129,129,129,129,129,3,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,180,180],
[180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180]
];

var mapArrayOutside=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
];

function drawMap(){
	
var tilesetImage = new Image();
tilesetImage.src = 'Images/basictiles.png';
tilesetImage.onload = drawImage;
var canvas = document.getElementById('myCanvas');
var ctx = canvas.getContext('2d');
var tileSize = 16;       // The size of a tile (32Ã—32)
var rowTileCount = 32;   // The number of tiles in a row of our background
var colTileCount = 32;   // The number of tiles in a column of our background
var imageNumTiles = 16;  // The number of tiles per row in the tileset image

	function drawImage () {
		for (var r = 0; r < rowTileCount; r++) {
			for (var c = 0; c < colTileCount; c++) {
				var tile = mapArray[ r ][ c ];
				var tileRow = (tile / imageNumTiles) | 0; // Bitwise OR operation
				var tileCol = (tile % imageNumTiles) | 0;
				ctx.drawImage(tilesetImage, (tileCol * tileSize), (tileRow * tileSize), tileSize, tileSize, (c * tileSize), (r * tileSize), tileSize, tileSize);
			}
		}
	}
};


socket.emit('newPlayer');




socket.on('chat message', function(data){
	$('#messages').append($('<li>').text(data));
});

$(document).ready(function(){
	$('#messagebox').submit(function(e){
	  e.preventDefault();
	  let m = $('#m').val();
	  socket.emit('chat message', m);
	  $('#m').val('');
	});
	drawMap();
	drawPlayer();
});

